def update_marked_faces_convex_hull(marked_faces_dict, push_value, marked_points=None):
    """Update preview with convex hull of marked faces/points"""
    global _state
    
    try:
        all_vertices = []

        # Collect vertices from marked faces
        for obj, face_indices in marked_faces_dict.items():
            if not face_indices or obj.type != 'MESH':
                continue

            mesh = obj.data
            obj_mat = obj.matrix_world

            # Batch process face vertices
            for face_idx in face_indices:
                if face_idx >= len(mesh.polygons):
                    continue

                face = mesh.polygons[face_idx]
                all_vertices.extend([obj_mat @ mesh.vertices[vert_idx].co for vert_idx in face.vertices])

        # Add marked points
        if marked_points:
            all_vertices.extend(marked_points)

        if not all_vertices:
            # No vertices means no bbox to show
            _state.current_bbox_data = None
            # Force clear bbox cache
            _state.gpu_manager.clear_cache_key('bbox_faces')
            _state.gpu_manager.clear_cache_key('bbox_edges')
            return

        # Re-enable bbox preview if it was disabled
        if 'bbox_preview' not in _state.handlers:
            enable_bbox_preview(_state)

        # Calculate Convex Hull
        bm = bmesh.new()
        for v in all_vertices:
            bm.verts.new(v)
        bm.verts.ensure_lookup_table()
        
        # convex_hull op can modify geometry, so we pass all verts
        ret = bmesh.ops.convex_hull(bm, input=bm.verts)
        
        # Remove internal geometry (geom not in convex hull output)
        # bmesh.ops.convex_hull returns:
        # "geom": operator output (edges and faces)
        # "geom_interior": interior geometry
        # "geom_unused": unused geometry
        # We should keep only the hull. 
        # Actually, simpler approach: create hull, then only keep faces that are part of the hull?
        # The standard approach for replacing mesh with hull is usually:
        # bmesh.ops.convex_hull(bm, input=bm.verts, use_existing_faces=False)
        # But here we are starting from scratch with just verts, so defaults are probably fine.
        # Let's recalc normals.
        bmesh.ops.recalc_face_normals(bm, faces=bm.faces)

        # Apply push value (inflate)
        if abs(push_value) > 0.0001:
            vert_normals = {v: Vector((0,0,0)) for v in bm.verts}
            for f in bm.faces:
                for v in f.verts:
                    vert_normals[v] += f.normal
            
            for v in bm.verts:
                if vert_normals[v].length_squared > 0:
                    normal = vert_normals[v].normalized()
                    v.co += normal * push_value

        # Prepare for drawing
        # Triangulate for face drawing
        bmesh.ops.triangulate(bm, faces=bm.faces)
        
        face_verts = []
        for f in bm.faces:
             for v in f.verts:
                 face_verts.append(v.co.copy())
        
        edge_verts = []
        for e in bm.edges:
            edge_verts.append(e.verts[0].co.copy())
            edge_verts.append(e.verts[1].co.copy())
            
        bm.free()

        _state.current_bbox_data = {
            'edges': edge_verts,
            'faces': face_verts,
            # Center and dimensions are not used by generic draw, but needed to match structure
            'center': Vector((0,0,0)), 
            'dimensions': Vector((0,0,0))
        }

        # Force clear bbox cache to ensure visual update
        _state.gpu_manager.clear_cache_key('bbox_faces')
        _state.gpu_manager.clear_cache_key('bbox_edges')

    except Exception as e:
        print(f"Error updating convex hull preview: {e}")
        _state.current_bbox_data = None
